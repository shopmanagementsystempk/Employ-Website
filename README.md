# Soft Verse - Company Web Application

A complete company web application built with React JS and Firebase, featuring admin and employee modules for managing users, generating visiting cards, and managing visitor entries.

## Features

### Admin Module
- **User Management**: Create, edit, block, and delete users
- **Employee Management**: Add, edit, and assign roles to employees
- **Activity Logs**: View and monitor all system activities
- **Card Templates**: Manage visiting card templates
- **Dashboard**: View statistics and system overview

### Employee Module
- **Visiting Card Generator**: Create and download personal visiting cards (PNG/PDF)
- **Visitor Card Generator**: Generate visitor cards for office guests
- **Visitor History**: View all visitors generated by the employee
- **Dashboard**: View personal statistics

### Security Features
- Firebase Authentication with Custom Claims for role-based access
- Secure Firestore and Storage rules following least-privilege principle
- Firebase App Check integration
- Role-based access control (Admin & Employee)
- Activity logging for audit trails

## Tech Stack

- **Frontend**: React 19.2.0, React Router DOM, React Bootstrap
- **Backend**: Firebase (Authentication, Firestore, Storage, Cloud Functions)
- **Card Generation**: html2canvas, jsPDF, qrcode.react
- **UI Framework**: Bootstrap 5.3.2
- **Notifications**: react-toastify

## Prerequisites

- Node.js (v14 or higher)
- npm or yarn
- Firebase account and project
- Firebase CLI installed globally (`npm install -g firebase-tools`)

## Installation

### 1. Clone the Repository

```bash
git clone <repository-url>
cd myapp
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Firebase Setup

1. Create a Firebase project at [Firebase Console](https://console.firebase.google.com/)

2. Enable the following services:
   - Authentication (Email/Password)
   - Firestore Database
   - Storage
   - Cloud Functions
   - App Check (optional but recommended)

3. Get your Firebase configuration:
   - Go to Project Settings > General
   - Scroll down to "Your apps" section
   - Copy the Firebase configuration object

4. Create a `.env` file in the root directory:

```env
REACT_APP_FIREBASE_API_KEY=your_api_key_here
REACT_APP_FIREBASE_AUTH_DOMAIN=your_project_id.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your_project_id
REACT_APP_FIREBASE_STORAGE_BUCKET=your_project_id.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
REACT_APP_FIREBASE_APP_ID=your_app_id
REACT_APP_FIREBASE_MEASUREMENT_ID=your_measurement_id
REACT_APP_FIREBASE_APP_CHECK_SITE_KEY=your_recaptcha_site_key
```

5. Initialize Firebase in your project:

```bash
firebase login
firebase init
```

Select:
- Firestore
- Functions
- Storage
- Hosting

### 4. Deploy Security Rules

```bash
firebase deploy --only firestore:rules,storage:rules
```

### 5. Deploy Cloud Functions

```bash
cd functions
npm install
cd ..
firebase deploy --only functions
```

### 6. Set Up App Check (Optional but Recommended)

1. Go to Firebase Console > App Check
2. Register your app
3. Add reCAPTCHA v3 provider
4. Copy the site key to your `.env` file

### 7. Create Initial Admin User

After deploying, you'll need to create an admin user manually:

1. Register a user through the application
2. In Firebase Console, go to Authentication > Users
3. Note the user's UID
4. In Firestore, go to the `users` collection
5. Find the user document and set `role: "admin"`
6. Run the Cloud Function to set custom claims, or use Firebase Admin SDK:

```javascript
// In Firebase Console > Functions > Logs, or use Admin SDK
admin.auth().setCustomUserClaims(uid, { role: 'admin' });
```

Alternatively, you can use the Cloud Function `setUserRole` after logging in as an admin.

## Running the Application

### Development Mode

```bash
npm start
```

The application will open at `http://localhost:3000`

### Production Build

```bash
npm run build
```

This creates an optimized production build in the `build` folder.

## Deployment

### Deploy to Firebase Hosting

```bash
npm run build
firebase deploy --only hosting
```

### Deploy Everything

```bash
firebase deploy
```

This will deploy:
- Firestore rules
- Storage rules
- Cloud Functions
- Hosting

## Project Structure

```
myapp/
├── public/
├── src/
│   ├── components/
│   │   ├── CardGenerator/
│   │   │   └── VisitingCardGenerator.js
│   │   ├── Layout/
│   │   │   └── Navbar.js
│   │   └── ProtectedRoute.js
│   ├── contexts/
│   │   └── AuthContext.js
│   ├── firebase/
│   │   └── config.js
│   ├── pages/
│   │   ├── Admin/
│   │   │   ├── Dashboard.js
│   │   │   ├── ManageUsers.js
│   │   │   ├── ManageEmployees.js
│   │   │   ├── ActivityLogs.js
│   │   │   └── CardTemplates.js
│   │   ├── Employee/
│   │   │   ├── Dashboard.js
│   │   │   ├── VisitingCard.js
│   │   │   ├── VisitorCard.js
│   │   │   └── VisitorHistory.js
│   │   ├── Home.js
│   │   ├── Login.js
│   │   ├── Register.js
│   │   └── Unauthorized.js
│   ├── App.js
│   └── index.js
├── functions/
│   ├── index.js
│   └── package.json
├── firestore.rules
├── storage.rules
├── firestore.indexes.json
├── firebase.json
└── package.json
```

## Security Rules Overview

### Firestore Rules
- Users can only read their own data (except admins)
- Only admins can manage users
- Employees can create visitors they host
- Only admins can manage templates and view logs

### Storage Rules
- Users can upload their own profile pictures
- Only admins can manage templates
- Employees can upload generated cards

## Cloud Functions

### setUserRole
Sets custom claims for user roles. Only callable by admins.

### logActivity
Logs user activities to Firestore.

### generatePDF
Optional server-side PDF generation (currently uses client-side).

### onUserLogin
Automatically logs user registration events.

## Usage Guide

### For Admins

1. **Login** with admin credentials
2. **Manage Users**: Go to Admin Dashboard > Manage Users
   - Edit user roles
   - Block/unblock users
   - Delete users
3. **Manage Employees**: Add employee information, designations, departments
4. **View Logs**: Monitor all system activities
5. **Manage Templates**: Create and manage card templates

### For Employees

1. **Login** with employee credentials
2. **Generate Visiting Card**: 
   - Go to "My Visiting Card"
   - Fill in personal information
   - Preview and download as PNG or PDF
3. **Generate Visitor Card**:
   - Go to "Generate Visitor Card"
   - Enter visitor information
   - Generate and download card
   - Save visitor entry
4. **View History**: Check all visitors you've generated cards for

## Troubleshooting

### Common Issues

1. **Authentication Errors**
   - Ensure Firebase Authentication is enabled
   - Check that email/password provider is enabled

2. **Permission Denied Errors**
   - Verify Firestore and Storage rules are deployed
   - Check user's role in custom claims
   - Ensure user is not blocked

3. **Cloud Functions Not Working**
   - Deploy functions: `firebase deploy --only functions`
   - Check function logs in Firebase Console
   - Verify Node.js version (should be 18)

4. **App Check Errors**
   - Ensure reCAPTCHA site key is correct
   - Verify App Check is properly configured in Firebase Console

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

## License

This project is licensed under the MIT License.

## Support

For issues and questions, please open an issue in the repository.

## Future Enhancements

- [ ] Email notifications for visitor entries
- [ ] Advanced card template editor
- [ ] Visitor check-in/check-out system
- [ ] Analytics dashboard
- [ ] Mobile app version
- [ ] Multi-language support
- [ ] Dark mode theme
